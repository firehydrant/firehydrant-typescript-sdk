name: Test Secret Access
on:
  workflow_dispatch:

jobs:
  test-secret:
    runs-on: ubuntu-latest
    steps:
      - name: Check if secret exists
        run: |
          if [ -z "${{ secrets.AUTO_MERGE_TOKEN }}" ]; then
            echo "âŒ AUTO_MERGE_TOKEN is not accessible"
            exit 1
          else
            echo "âœ… AUTO_MERGE_TOKEN is accessible"
          fi
          
      - name: Test with GitHub CLI
        env:
          GITHUB_TOKEN: ${{ secrets.AUTO_MERGE_TOKEN }}
        run: |
          echo "ğŸ” Testing authentication..."
          
          # Get authenticated user
          if USER=$(gh api user --jq .login 2>&1); then
            echo "âœ… Authenticated as: $USER"
          else
            echo "âŒ Authentication failed: $USER"
            exit 1
          fi
          
          # Test repository access
          echo "ğŸ“‹ Testing repository access..."
          if REPO=$(gh api repos/${{ github.repository }} --jq .full_name 2>&1); then
            echo "âœ… Can access repository: $REPO"
          else
            echo "âŒ Cannot access repository: $REPO"
            exit 1
          fi
          
          # Test PR operations
          echo "ğŸ” Testing PR access..."
          if PRS=$(gh pr list --repo ${{ github.repository }} --limit 1 2>&1); then
            echo "âœ… Can access pull requests"
          else
            echo "âŒ Cannot access PRs: $PRS"
            exit 1
          fi
          
          echo "ğŸ‰ All tests passed!"